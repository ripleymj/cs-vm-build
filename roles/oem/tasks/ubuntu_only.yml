---
# tasks file for Ubuntu

- name: Upgrade all installed packages
  apt:
    upgrade: safe
- name: Upgrade all installed snaps  # noqa no-changed-when
  command: snap refresh
- name: Purge old snaps
  shell: |
    errors=0
    while read snapname revision; do
      snap remove "$snapname" --revision="$revision"
      errors=$((errors + $?))
    done <<< "$(snap list --all | awk '/disabled/{print $1, $3}')"
    exit $errors
  changed_when: false
- name: Copy dconf config file
  copy:
    src: csconfig-ubuntuonly
    dest: /etc/dconf/db/local.d/csconfig-ubuntuonly
    owner: root
    group: root
    mode: "0644"
  notify:
    - Update dconf database
